32位下堆题，开启NX和canary保护机制，包含增删查三个功能，打印功能是自己实现且放在管理堆块处，漏洞点在删除处没有清空指针导致UAF漏洞。

攻击思路：
1. 分配smallbin大小的堆块，释放后放入unsorted_bin，要重新申请回来才能用打印功能，利用UAF漏洞泄露libc基址。
2. 释放两个note，然后添加新堆块，指定大小为8以获取管理堆块，然后把打印函数的指针改成system函数，从而获取shell。

踩坑点：
1. 一开始把打印函数改成system函数之后，不知道要怎么执行/bin/sh或者sh，所以尝试想写one_gadget但是发现都不管用。
然后在网上看其他师傅的博客，发现用了一个小技巧，linux下shell的管道符`;`，能够拼接命令然后执行。
2. libc基址泄露时要用相对地址，一开始我在本地调试的时候直接把泄露的值减去一个差值得到基址，以前遇到的情况下都是行得通的，我就以为同一libc版本下是一样的。
但是本题行不通了，同一libc版本下这个差值也是有可能不同的，所以最后改成`libc.sym['__malloc_hook'] + 0x48`这个值作为基址与unsorted_bin的差值。
比较奇怪的是一开始我想用`libc.sym['main_arena']`的偏移，结果发现找不到符号？？
3. ASLR导致libc加载位置不固定，system函数的末12位是固定的，某次攻击中出现system函数的地址包含了`)`字符，在linux的shell里面似乎有特殊用法所以命令拼接失败了，多试几次避免掉这些特殊字符即可。



[参考博客](https://blog.csdn.net/qq_35713009/article/details/87900729)
